<mat-card id='edit_case_note'>
  <mat-card-header>
    <span class="spacer"></span>
    <span>
      <button id="exit_button" mat-stroked-button color="primary" (click)="cancelAddCaseNote()">Exit</button>
    </span>
  </mat-card-header>
    <mat-card-content>
      <form [formGroup]="caseNoteForm" validate autocomplete="off">
        <div class="add-casenote-form-container">
          <div class="casenote-date-time-container">
            <div class="date-input-container">
              <mat-form-field appearance="outline">
                <mat-label>Date</mat-label>
                <input matInput [matDatepicker]="datePicker" formControlName="date" placeholder="Date" id="date" required>
                <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
                <mat-datepicker #datePicker></mat-datepicker>
                <mat-error *ngIf="caseNoteForm.get('date').hasError('required')">
                  Date is required
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <p *ngFor="let error of errors" class="mat-error">{{error.message}}</p>
          <div class="card-row">
            
            <mat-form-field appearance="outline" class="mr10">
              <mat-label>Start Time (Hours)</mat-label>
              <mat-select placeholder="Time (Hours)" formControlName="timeHours" id="timeHours" required>
                <mat-option *ngFor="let hour of hours" [value]="hour.value" id="time_{{hour}}">
                  {{hour.label}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="caseNoteForm.get('timeHours').hasError('required')">
                Start Time (Hours) is required
              </mat-error>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="mr10">
              <mat-label>Start Time (Minutes)</mat-label>
              <mat-select placeholder="Time (Minutes)" formControlName="timeMinutes" id="timeMinutes" required>
                <mat-option *ngFor="let minute of minutes" [value]="minute" id="time_{{minute}}">
                  {{minute}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="caseNoteForm.get('timeMinutes').hasError('required')">
                Start Time (Minutes) is required
              </mat-error>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="mr10">
              <mat-label>End Time (Hours)</mat-label>
              <mat-select placeholder="Time (Hours)" formControlName="endTimeHours" id="endTimeHours">
                <mat-option *ngFor="let hour of hours" [value]="hour.value" id="time_{hour}}">
                  {{hour.label}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="caseNoteForm.get('endTimeHours').hasError('required')">
                <p *ngFor="let error of errors" class="mat-error-end">{{error.message}} </p>
              </mat-error>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="mr10">
              <mat-label>End Time (Minutes)</mat-label>
              <mat-select placeholder="Time (Minutes)" formControlName="endTimeMinutes" id="endTimeMinutes">
                <mat-option *ngFor="let minute of minutes" [value]="minute" id="time_{{minute}}">
                  {{minute}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="caseNoteForm.get('endTimeMinutes').hasError('required')">
                <p *ngFor="let error of errors" class="mat-error-end">{{error.message}} </p>
              </mat-error>
            </mat-form-field>
          </div>
  
          <div class="card-row">
            <div class="card-column">
              <mat-form-field appearance="outline">
                <mat-label>Worker</mat-label>
                <mat-select [disabled] = "disableFlag" placeholder="Worker" formControlName="noteSenderId" required >
                  <mat-option *ngFor="let worker of workerList" [value]="worker.id" id="worker">{{worker.userFullName}}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="caseNoteForm.get('noteSenderId').hasError('required')"> Worker name is required
                </mat-error>
              </mat-form-field>
            </div>
            <div class="card-column">
              <mat-form-field appearance="outline">
                <mat-label>Activity</mat-label>
                <mat-select placeholder="Activity"
                  formControlName="activityId" required>
                  <mat-option *ngFor="let inter of caseNoteActivity" [value]="inter.id" id="inter">{{inter.description}}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="caseNoteForm.get('activityId').hasError('required')"> Activity is required
                </mat-error>
              </mat-form-field>
            </div>
          </div>
  
          <div class="card-row">
      
            <div class="card-column">
              <mat-form-field appearance="outline">
                <mat-label>Type</mat-label>
                <mat-select placeholder="Type" (selectionChange)="onTypeChange($event)" formControlName="typeId" required>
                  <mat-option *ngFor="let type of appointmentList" [value]="type.id" id="type">{{type.name}}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="caseNoteForm.get('typeId').hasError('required')"> Type is required
                </mat-error>
              </mat-form-field>
            </div>
          </div>
  
          <div class="card-row">
            <div class="card-column" *ngIf="isOtherType">
              <mat-form-field appearance="outline">
                <mat-label>Other Type</mat-label>
                <textarea matInput formControlName="otherType" rows="3" required minlength="1" maxlength="100"
                  required></textarea>
                <mat-hint *ngIf="caseNoteForm.controls.otherType.valid">
                  {{100 - caseNoteForm.controls.otherType.value.length}} characters left
                </mat-hint>
                <mat-hint
                  *ngIf="caseNoteForm.controls.otherType.value?.length === null || caseNoteForm.controls.otherType.value?.length === 0">
                  Minimum 1 and Maximum 100 characters allowed
                </mat-hint>
                <mat-error *ngIf="caseNoteForm.controls.otherType.invalid && !caseNoteForm.controls.otherType.errors?.minlength && 
                  !caseNoteForm.controls.otherType.errors?.maxlength">
                  Other type name is required
                </mat-error>
                <mat-error
                  *ngIf="caseNoteForm.controls.otherType.errors?.minlength || caseNoteForm.controls.otherType.errors?.maxlength">
                  Minimum 1 and maximum 100 characters allowed
                </mat-error>
              </mat-form-field>
            </div>
  
            <div class="card-column">
              <mat-form-field appearance="outline">
                <mat-label>Case Note</mat-label>
                <textarea matInput formControlName="noteText" rows="3" required minlength="1" maxlength="3000"
                  required></textarea>
                <mat-hint *ngIf="caseNoteForm.controls.noteText.valid">
                  {{3000 - caseNoteForm.controls.noteText.value.length}} characters left
                </mat-hint>
                <mat-hint *ngIf="caseNoteForm.controls.noteText.value?.length === 0">
                  Minimum 1 and Maximum 3000 characters allowed
                </mat-hint>
                <mat-error *ngIf="caseNoteForm.controls.noteText.invalid && !caseNoteForm.controls.noteText.errors?.minlength && 
                      !caseNoteForm.controls.noteText.errors?.maxlength">
                  Mandatory Field
                </mat-error>
                <mat-error
                  *ngIf="caseNoteForm.controls.noteText.errors?.minlength || caseNoteForm.controls.noteText.errors?.maxlength">
                  Minimum 1 and maximum 3000 characters allowed
                </mat-error>
              </mat-form-field>
            </div>
          </div>
  
          <mat-card-footer>
            <span class="spacer"></span>
            <span>
              <button type="submit" id="save_user_button" mat-flat-button color="primary" (click)="onSubmit(caseNoteForm)"
                [disabled]="addButtonDisabled()">{{btnTitle}}</button>
            </span>
          </mat-card-footer>
        </div>
      </form>
    </mat-card-content>
  </mat-card>